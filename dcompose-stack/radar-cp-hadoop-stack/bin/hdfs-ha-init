#!/bin/bash

cd "$(dirname "${BASH_SOURCE[0]}")/.."

. ./.env

echo "Are you sure you want to initialize HDFS?"

select yn in "Yes" "No"; do
  case $yn in
    Yes ) break;;
    No ) exit;;
  esac
done

bin/radar-docker up -d --remove-orphans zookeeper-1 zookeeper-2 zookeeper-3 hdfs-journalnode-1 hdfs-journalnode-2 hdfs-journalnode-3
bin/radar-docker quit hdfs-namenode-1 hdfs-namenode-2
bin/radar-docker run --rm hdfs-namenode-1 namenode-1 -initializeSharedEdits
bin/radar-docker up -d hdfs-namenode-1
echo "Waiting for HDFS namenode to come online..."
while ! bin/radar-docker exec hdfs-namenode-1 hdfs dfs -test -e hdfs://hdfs-namenode-1/; do
  sleep 1
done
bin/radar-docker run --rm --name hdfs-namenode-2 hdfs-namenode-2 namenode-2 -bootstrapStandby -force
bin/radar-docker hdfs
